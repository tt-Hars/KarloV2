# Logging Service Database Design

## Overview
The Logging Service uses **DataStax Astra DB** (Cassandra) as its persistent storage. It stores structured log entries from various microservices in a single collection.

## Connection
- **Database**: Astra DB
- **Keyspace**: Configured via `KEYSPACE` environment variable (default: `default_keyspace`).
- **Endpoint**: Configured via `ASTRA_DB_API_ENDPOINT` or `ASTRA_ENDPOINT`.
- **Token**: Configured via `ASTRA_DB_APPLICATION_TOKEN` or `ASTRA_TOKEN`.

## Collections

### `service_logs`

This collection stores all log entries.

#### Schema (Implicit)
Since Astra DB acts as a Document Store (JSON), the schema is flexible. However, the standard log entry structure follows this format:

```json
{
  "_id": "uuid-v4-auto-generated",
  "timestamp": "2023-10-27T10:00:00.000Z",
  "service": "auth-service",
  "correlationId": "abc-123-xyz",
  "level": "info",
  "message": "User logged in successfully",
  "receivedAt": "2023-10-27T10:00:01.000Z",
  "meta": {
    "userId": "user_123",
    "ip": "127.0.0.1"
  }
}
```

#### Fields

| Field | Type | Description |
| :--- | :--- | :--- |
| `_id` | String | Unique identifier for the log entry (auto-generated by DB if not provided, or UUID). |
| `timestamp` | String (ISO Date) | The time the event occurred (generated by the source service). |
| `receivedAt` | String (ISO Date) | The time the log was received by the logging service. |
| `service` | String | Name of the service generating the log (e.g., `auth-service`, `feeds-service`). |
| `correlationId` | String | Unique ID for tracing requests across microservices. |
| `level` | String | Log level (`info`, `warn`, `error`, `debug`). |
| `message` | String | The main log message. |
| `meta` | Object (Optional) | Additional metadata or context (args, stack trace, etc.). |

## Access Patterns

1.  **Write**: High-frequency writes via `insertMany` (buffered batch inserts).
2.  **Read**: Primarily for debugging and auditing. Queries typically filter by `correlationId`, `service`, or `timestamp`.
